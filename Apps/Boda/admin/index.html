<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Panel · Boda Misael</title>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
      crossorigin="anonymous"
    />
    <link rel="icon" type="image/png" sizes="any" href="../assets/images/icono.png?v=1" />
    <link rel="apple-touch-icon" sizes="180x180" href="../assets/images/icono.png?v=1" />
    <link rel="shortcut icon" href="../assets/images/icono.png?v=1" />
    <link rel="stylesheet" href="../assets/css/styles.css" />
    <link
      rel="stylesheet"
      href="https://cdn.datatables.net/1.13.8/css/jquery.dataTables.min.css"
    />
    <link
      rel="stylesheet"
      href="https://cdn.datatables.net/responsive/2.5.0/css/responsive.dataTables.min.css"
    />
  </head>
  <body class="admin">
    <header class="admin__header">
      <div class="container">
        <div>
          <h1>Panel de la boda</h1>
          <p id="rol-info" class="form-helper">Rol actual: --</p>
        </div>
        <div class="header-stats hidden">
          <div class="capacity-pill">
            Invitados activos: <strong id="header-activos">--</strong>
          </div>
          <div class="capacity-pill capacity-pill--free">
            Lista de espera: <strong id="header-espera">--</strong>
          </div>
          <div class="capacity-pill capacity-pill--free">
            Lugares disponibles: <strong id="header-disponibles">--</strong>
          </div>
          <button id="logout-btn" class="btn btn--secondary">Cerrar sesión</button>
        </div>
        <div class="header-dates hidden">
          <div class="deadline-node">
            <div class="deadline-node__title">Confirmar asistencia</div>
            <div class="deadline-node__date" id="header-fecha-respuesta">--</div>
            <small class="deadline-node__description">
              Fecha límite para que cada invitado confirme si asistirá.
            </small>
          </div>
          <div class="deadline-node">
            <div class="deadline-node__title">Checklist atuendo y viaje</div>
            <div class="deadline-node__date" id="header-fecha-detalles">--</div>
            <small class="deadline-node__description">
              Momento en que deben tener listo vestimenta, viaje y hospedaje.
            </small>
          </div>
          <div class="deadline-node">
            <div class="deadline-node__title">Día de la boda</div>
            <div class="deadline-node__date" id="header-fecha-boda">--</div>
            <small class="deadline-node__description">
              Fecha oficial que mostramos en la portada pública.
            </small>
          </div>
        </div>
        <div id="header-countdown" class="header-countdown hidden">
          <div class="countdown-card">
            <p class="countdown-card__label">Cuenta regresiva</p>
            <div class="countdown" id="wedding-countdown">
              <div class="countdown__item">
                <span id="countdown-days">--</span>
                <small>Días</small>
              </div>
              <div class="countdown__item">
                <span id="countdown-hours">--</span>
                <small>Horas</small>
              </div>
              <div class="countdown__item">
                <span id="countdown-minutes">--</span>
                <small>Minutos</small>
              </div>
              <div class="countdown__item">
                <span id="countdown-seconds">--</span>
                <small>Segundos</small>
              </div>
            </div>
            <p class="countdown-card__date" id="countdown-target-label">--</p>
            <p class="countdown-card__helper" id="countdown-message">
              Define la fecha del evento para activar la cuenta regresiva.
            </p>
          </div>
        </div>
      </div>
    </header>

    <main class="container">
      <section id="auth-section" class="card">
        <h2>Acceso</h2>
        <form id="login-form">
          <label for="email">Correo</label>
          <input type="email" id="email" required />
          <label for="password">Contraseña</label>
          <input type="password" id="password" required />
          <button type="submit" class="btn">Ingresar</button>
          <p id="login-message" class="form-helper"></p>
        </form>
      </section>

      <section id="dashboard" class="hidden">
        <ul class="nav nav-tabs" id="panelTabs" role="tablist">
          <li class="nav-item" role="presentation">
            <button
              class="nav-link active"
              id="tab-invitados-tab"
              data-bs-toggle="tab"
              data-bs-target="#tab-invitados"
              type="button"
              role="tab"
              aria-controls="tab-invitados"
              aria-selected="true"
            >
              Invitados
            </button>
          </li>
          <li class="nav-item" role="presentation">
            <button
              class="nav-link"
              id="tab-mesas-tab"
              data-bs-toggle="tab"
              data-bs-target="#tab-mesas"
              type="button"
              role="tab"
              aria-controls="tab-mesas"
              aria-selected="false"
            >
              Mesas
            </button>
          </li>
          <li class="nav-item" role="presentation">
            <button
              class="nav-link"
              id="tab-fechas-tab"
              data-bs-toggle="tab"
              data-bs-target="#tab-fechas"
              type="button"
              role="tab"
              aria-controls="tab-fechas"
              aria-selected="false"
            >
              Fechas límite
            </button>
          </li>
          <li class="nav-item" role="presentation">
            <button
              class="nav-link"
              id="tab-pendientes-tab"
              data-bs-toggle="tab"
              data-bs-target="#tab-pendientes"
              type="button"
              role="tab"
              aria-controls="tab-pendientes"
              aria-selected="false"
            >
              Pendientes
            </button>
          </li>
          <li class="nav-item" role="presentation">
            <button
              class="nav-link"
              id="tab-presupuesto-tab"
              data-bs-toggle="tab"
              data-bs-target="#tab-presupuesto"
              type="button"
              role="tab"
              aria-controls="tab-presupuesto"
              aria-selected="false"
            >
              Presupuesto
            </button>
          </li>
          <li class="nav-item" role="presentation">
            <button
              class="nav-link"
              id="tab-itinerario-tab"
              data-bs-toggle="tab"
              data-bs-target="#tab-itinerario"
              type="button"
              role="tab"
              aria-controls="tab-itinerario"
              aria-selected="false"
            >
              Itinerario
            </button>
          </li>
          <li class="nav-item" role="presentation">
            <button
              class="nav-link"
              id="tab-ubicaciones-tab"
              data-bs-toggle="tab"
              data-bs-target="#tab-ubicaciones"
              type="button"
              role="tab"
              aria-controls="tab-ubicaciones"
              aria-selected="false"
            >
              Ubicaciones
            </button>
          </li>
          <li class="nav-item" role="presentation">
            <button
              class="nav-link"
              id="tab-mensajes-tab"
              data-bs-toggle="tab"
              data-bs-target="#tab-mensajes"
              type="button"
              role="tab"
              aria-controls="tab-mensajes"
              aria-selected="false"
            >
              Mensajes
            </button>
          </li>
          <li class="nav-item" role="presentation">
            <button
              class="nav-link"
              id="tab-landing-tab"
              data-bs-toggle="tab"
              data-bs-target="#tab-landing"
              type="button"
              role="tab"
              aria-controls="tab-landing"
              aria-selected="false"
            >
              Landing público
            </button>
          </li>
          <li class="nav-item" role="presentation">
            <button
              class="nav-link"
              id="tab-damas-tab"
              data-bs-toggle="tab"
              data-bs-target="#tab-damas"
              type="button"
              role="tab"
              aria-controls="tab-damas"
              aria-selected="false"
            >
              Damas y Caballeros
            </button>
          </li>
        </ul>

        <div class="tab-content" id="panelTabsContent">

        <div class="tab-pane fade show active" id="tab-invitados" role="tabpanel" aria-labelledby="tab-invitados-tab">
          <div class="card capacity-panel">
            <div class="table-header">
              <h2>Capacidad general</h2>
              <div class="table-actions capacity-pill-group">
                <span class="capacity-pill">
                  Capacidad: <strong id="summary-capacidad">--</strong>
                </span>
                <span class="capacity-pill capacity-pill--free">
                  Disponibles: <strong id="summary-disponibles">--</strong>
                </span>
              </div>
              <div class="table-actions capacity-pill-group">
                <span class="capacity-pill capacity-pill--neutral">
                  Lugares ocupados (Novia): <strong id="summary-novia">--</strong>
                </span>
                <span class="capacity-pill capacity-pill--neutral">
                  Lugares ocupados (Novio): <strong id="summary-novio">--</strong>
                </span>
              </div> 
            </div>
            <form id="capacidad-form" class="capacity-form">
              <label for="capacidadMaxima" class="form-helper">Capacidad máxima de invitados</label>
              <div class="input-group">
                <input type="number" min="0" id="capacidadMaxima" name="capacidadMaxima" placeholder="Ej. 180" />
                <button type="button" id="guardar-capacidad" class="btn btn--secondary">Guardar</button>
              </div>
            </form>
          </div>

          <div class="card filters">
            <h2>Filtros rápidos</h2>
            <div class="filter-buttons">
              <button data-filter="fase1" class="btn btn--ghost">Confirmó asistencia</button>
              <button data-filter="final" class="btn btn--ghost">Checklist completo</button>
              <button data-filter="lista-espera" class="btn btn--ghost">Lista de espera</button>
              <button data-filter="todos" class="btn btn--ghost">Ver todos</button>
            </div>
            <div class="lado-filter">
              <label for="lado-filter-select">Filtrar por lado</label>
              <select id="lado-filter-select">
                <option value="todos">Todos los invitados</option>
                <option value="novia">Solo invitados de la novia</option>
                <option value="novio">Solo invitados del novio</option>
              </select>
            </div>
            <div class="tag-filter">
              <p>Filtrar por etiquetas:</p>
              <div id="tag-filter-container" class="tag-filter__chips">
                <span class="form-helper">No hay etiquetas disponibles todavía.</span>
              </div>
            </div>
          </div>

          <section class="card">
            <div class="table-header">
              <h2>Invitados</h2> 
              <div class="table-actions">
                <button id="refresh-table" class="btn btn--secondary">Actualizar</button>
                <button id="add-invitado-btn" class="btn hidden">Agregar invitado</button>
              </div>
            </div>
            <div class="table-wrapper">
              <table id="tabla-invitados" class="display">
                <thead>
                  <tr>
                    <th>Nombre completo</th>
                    <th>Lado</th>
                    <th>Código</th>
                    <th>N° invitados</th>
                    <th>Adultos</th>
                    <th>Niños</th>
                    <th>Contacto</th>
                    <th>WhatsApp</th>
                    <th>Estado</th>
                    <th>Acciones</th>
                    <th>N° confirmados</th>
                    <th>Vestimenta</th>
                    <th>Viaje</th>
                    <th>Hospedaje</th>
                    <th>Lista espera</th>
                    <th>Prioridad</th>
                    <th>Etiquetas</th>
                    <th>Contactos adicionales</th>
                    <th>Gestión de cupo</th>
                  </tr>
                </thead>
                <tbody id="tabla-body"></tbody>
              </table>
            </div>
          </section>

          <section class="card">
            <div class="table-header">
              <h2>Lista de espera</h2>
              <div class="table-actions">
                <span class="form-helper" id="waitlist-status">Prioridad más alta al inicio</span>
              </div>
            </div>
            <div class="table-wrapper">
              <table class="display" id="tabla-lista-espera">
                <thead>
                  <tr>
                    <th>Nombre completo</th>
                    <th>Lado</th>
                    <th>Código</th>
                    <th>N° invitados</th>
                    <th>Adultos</th>
                    <th>Niños</th>
                    <th>Contacto</th>
                    <th>WhatsApp</th>
                    <th>Estado</th>
                    <th>Acciones</th>
                    <th>N° confirmados</th>
                    <th>Vestimenta</th>
                    <th>Viaje</th>
                    <th>Hospedaje</th>
                    <th>Lista espera</th>
                    <th>Prioridad</th>
                    <th>Etiquetas</th>
                    <th>Contactos adicionales</th>
                    <th>Gestión de cupo</th>
                  </tr>
                </thead>
                <tbody id="waitlist-body"></tbody>
              </table>
            </div>
        </section>

        </div>

        <div class="tab-pane fade" id="tab-mesas" role="tabpanel" aria-labelledby="tab-mesas-tab">
          <section class="card card--mesas">
            <div class="table-header">
              <h2>Plano de mesas</h2>
              <div class="table-actions">
                <button type="button" class="btn btn--secondary" id="mesas-refresh">Actualizar listado</button>
              </div>
            </div>
            <div class="mesas-config">
              <div class="mesas-config__field">
                <label for="mesas-total">Mesas totales</label>
                <input type="number" id="mesas-total" min="1" value="6" />
              </div>
              <div class="mesas-config__field">
                <label for="mesas-capacidad">Invitados por mesa</label>
                <input type="number" id="mesas-capacidad" min="1" value="8" />
              </div>
              <div class="mesas-config__actions">
                <button type="button" class="btn btn--secondary" id="mesas-aplicar">
                  Aplicar cambios
                </button>
              </div>
            </div>
            <p class="form-helper">
              Arrastra las mesas para acomodarlas en el plano y asigna invitados dando clic en los “monitos” que rodean cada mesa.
              Cada vez que asignes a alguien, su pase digital se actualiza automáticamente.
            </p>
            <div class="mesas-builder">
              <div class="mesas-plano-wrapper">
                <div id="mesas-plano" class="mesas-plano">
                  <p class="form-helper">Configura la cantidad de mesas para comenzar.</p>
                </div>
              </div>
              <div class="mesas-sidepanel">
                <div class="mesas-selection">
                  <p class="form-helper">Invitado seleccionado</p>
                  <strong id="mesa-invitado-seleccion">Nadie seleccionado</strong>
                  <div class="mesas-selection__actions">
                    <button type="button" class="btn btn--ghost" id="mesa-cancelar-seleccion">
                      Cancelar selección
                    </button>
                  </div>
                  <p class="form-helper mesas-selection__hint" id="mesa-hint">
                    Elige un invitado sin mesa para asignarlo.
                  </p>
                </div>
                <div class="mesas-sidepanel__section">
                  <div class="table-header">
                    <h4>Invitados sin mesa</h4>
                    <div class="table-actions">
                      <span class="tag-chip" id="mesas-unassigned-count">--</span>
                    </div>
                  </div>
                  <div id="mesas-invitados-list" class="mesas-invitados-list">
                    <p class="form-helper">Todos tus invitados confirmados ya tienen mesa.</p>
                  </div>
                </div>
              </div>
            </div>
          </section>
        </div>

        <div class="tab-pane fade" id="tab-fechas" role="tabpanel" aria-labelledby="tab-fechas-tab">
          <div class="card deadline-panel" id="deadline-panel">
            <div class="table-header">
              <h2>Fechas límite</h2>
              <div class="table-actions">
                <span class="tag-chip tag-chip--status" id="deadline-sync-status">Sin cambios</span>
              </div>
            </div>
            <form id="deadline-form" class="grid-2 form-grid deadline-form" autocomplete="off">
              <label class="deadline-label">
                <span class="deadline-label__title">Fecha límite para confirmar asistencia</span>
                <span class="deadline-label__tag">Estado interno: DIJO_QUE_SI</span>
                <input type="datetime-local" name="fechaLimiteRespuesta" />
              </label>
              <label class="deadline-label">
                <span class="deadline-label__title">Fecha límite checklist (atuendo y viaje)</span>
                <span class="deadline-label__tag">Estado interno: SI_CONFIRMADO</span>
                <input type="datetime-local" name="fechaLimiteDetalles" />
              </label>
              <label class="deadline-label">
                <span class="deadline-label__title">Fecha del evento</span>
                <span class="deadline-label__tag">Se usa en la portada pública</span>
                <input type="datetime-local" name="fechaBoda" />
              </label>
              <div class="form-actions">
                <button type="button" id="apply-deadlines-all" class="btn btn--danger">
                  Actualizar para todos
                </button>
                <button type="button" id="clear-deadlines" class="btn btn--ghost">
                  Limpiar
                </button>
              </div>
              <p class="form-helper">
                Define aquí las fechas por defecto para nuevos invitados. También puedes aplicarlas a registros sin fechas.
              </p>
              <p class="form-helper timeline-note">
                <strong>Confirma asistencia (DIJO_QUE_SI)</strong> marca el plazo para que respondan
                si asistirán. <strong>Checklist (SI_CONFIRMADO)</strong> es la fecha límite para
                confirmar atuendo y viaje, y <strong>Día de la boda</strong> es la fecha oficial que
                mostramos al público.
              </p>
              <div class="deadline-timeline">
                <div class="deadline-node">
                  <div class="deadline-node__title">Confirma asistencia</div>
                  <div class="deadline-node__tag">DIJO_QUE_SI</div>
                  <div class="deadline-node__date" id="summary-fecha-respuesta">--</div>
                </div>
                <div class="deadline-node">
                  <div class="deadline-node__title">Checklist de atuendo y viaje</div>
                  <div class="deadline-node__tag">SI_CONFIRMADO</div>
                  <div class="deadline-node__date" id="summary-fecha-detalles">--</div>
                </div>
                <div class="deadline-node">
                  <div class="deadline-node__title">Día de la boda</div>
                  <div class="deadline-node__tag">Portada</div>
                  <div class="deadline-node__date" id="summary-fecha-boda">--</div>
                </div>
              </div>
            </form>
          </div>
        </div>

        <div class="tab-pane fade" id="tab-pendientes" role="tabpanel" aria-labelledby="tab-pendientes-tab">
          <section class="card">
            <div class="table-header">
              <h2>Tablero de pendientes</h2>
              <div class="table-actions">
                <button id="add-tarea-btn" class="btn btn--secondary hidden">Nueva tarea</button>
              </div>
            </div>
            <div class="lado-filter">
              <label for="filtro-tareas-responsable">Filtrar por responsable</label>
              <select id="filtro-tareas-responsable">
                <option value="todos">Todos</option>
                <option value="novia">Solo novia</option>
                <option value="novio">Solo novio</option>
                <option value="ayudantes">Solo ayudantes</option>
                <option value="ambos">Novia y novio</option>
              </select>
            </div>
            <p class="form-helper">
              Arranca cada tarea como <strong>Pendiente</strong>, pásala a <strong>En progreso</strong> cuando alguien la tome y marca
              <strong>Completado</strong> al cerrarla. No olvides definir su fecha límite.
            </p>
            <div class="kanban-board">
              <div class="kanban-column">
                <div class="kanban-column__header">
                  <h3>Pendiente</h3>
                  <span class="kanban-count" id="count-pendiente">0</span>
                </div>
                <div class="kanban-column__body" id="kanban-pendiente"></div>
              </div>
              <div class="kanban-column">
                <div class="kanban-column__header">
                  <h3>En progreso</h3>
                  <span class="kanban-count" id="count-progreso">0</span>
                </div>
                <div class="kanban-column__body" id="kanban-progreso"></div>
              </div>
              <div class="kanban-column">
                <div class="kanban-column__header">
                  <h3>Completado</h3>
                  <span class="kanban-count" id="count-completado">0</span>
                </div>
                <div class="kanban-column__body" id="kanban-completado"></div>
              </div>
            </div>
          </section>
        </div>

        <div class="tab-pane fade" id="tab-presupuesto" role="tabpanel" aria-labelledby="tab-presupuesto-tab">
          <section class="card budget-summary-card">
            <div class="table-header">
              <h2>Resumen financiero</h2>
            </div>
            <div class="budget-totals">
              <div class="budget-total">
                <p>Ingresos totales</p>
                <strong id="budget-ingresos">--</strong>
              </div>
              <div class="budget-total">
                <p>Gastos totales</p>
                <strong id="budget-gastos">--</strong>
              </div>
              <div class="budget-total">
                <p>Apoyos / Ahorros</p>
                <strong id="budget-apoyos">--</strong>
              </div>
              <div class="budget-total budget-total--balance">
                <p>Saldo</p>
                <strong id="budget-balance">--</strong>
              </div>
            </div>
            <div class="budget-chart">
              <canvas id="presupuesto-chart" height="220"></canvas>
            </div>
          </section>

          <section class="card">
            <div class="table-header">
              <h2>Detalle de gastos e ingresos</h2>
              <div class="table-actions">
                <button id="add-presupuesto-btn" class="btn btn--secondary hidden">Nuevo movimiento</button>
              </div>
            </div>
            <div class="table-wrapper">
              <table>
                <thead>
                  <tr>
                    <th>Concepto</th>
                    <th>Tipo</th>
                    <th>Modalidad</th>
                    <th>Monto fijo</th>
                    <th>Costo adultos</th>
                    <th>Costo niños</th>
                    <th>Notas</th>
                    <th>Total</th>
                    <th>Acciones</th>
                  </tr>
                </thead>
                <tbody id="presupuesto-body">
                  <tr>
                    <td colspan="9">Todavía no registras movimientos.</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </section>

          <section class="card">
            <div class="table-header">
              <h2>Ahorros y apoyos</h2>
              <div class="table-actions">
                <button id="add-apoyo-btn" class="btn btn--secondary hidden">Nuevo apoyo</button>
              </div>
            </div>
            <div class="table-wrapper">
              <table>
                <thead>
                  <tr>
                    <th>Descripción</th>
                    <th>Monto</th>
                    <th>Notas</th>
                    <th>Acciones</th>
                  </tr>
                </thead>
                <tbody id="apoyos-body">
                  <tr>
                    <td colspan="4">Aún no registras apoyos.</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </section>
        </div>

        <div class="tab-pane fade" id="tab-itinerario" role="tabpanel" aria-labelledby="tab-itinerario-tab">
          <div class="card itinerary-form-card">
            <h2>Itinerario del evento</h2>
            <form id="itinerario-form" class="form-grid">
              <label>Nombre del evento
                <input type="text" name="nombreEvento" placeholder="Ceremonia civil" required />
              </label>
              <label>Lugar
                <input type="text" name="lugarEvento" placeholder="Salon, Jardín, etc." required />
              </label>
              <label>Horario
                <input type="datetime-local" name="horaEvento" required />
              </label>
              <div class="form-actions">
                <button type="submit" class="btn">Agregar al itinerario</button>
              </div>
              <p class="form-helper" id="itinerario-mensaje"></p>
            </form>
          </div>

          <section class="card">
            <div class="table-header">
              <h2>Eventos programados</h2>
            </div>
            <div class="table-wrapper">
              <table class="display" id="tabla-itinerario">
                <thead>
                  <tr>
                    <th>Evento</th>
                    <th>Lugar</th>
                    <th>Horario</th>
                    <th>Acciones</th>
                  </tr>
                </thead>
                <tbody id="itinerario-body">
                  <tr>
                    <td colspan="4">Todavía no hay eventos en el itinerario.</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </section>
        </div>

        <div class="tab-pane fade" id="tab-ubicaciones" role="tabpanel" aria-labelledby="tab-ubicaciones-tab">
          <section class="card">
            <div class="table-header">
              <h2>Ubicaciones clave</h2>
              <div class="table-actions">
                <button id="add-ubicacion-btn" class="btn btn--secondary hidden">Nueva ubicación</button>
              </div>
            </div>
            <p class="form-helper">
              Registra los lugares importantes como recepción, ceremonia civil o puntos de reunión para tenerlos
              a la mano y compartirlos fácilmente.
            </p>
            <div class="table-wrapper">
              <table>
                <thead>
                  <tr>
                    <th>Nombre</th>
                    <th>Dirección</th>
                    <th>Mapa</th>
                    <th>Acciones</th>
                  </tr>
                </thead>
                <tbody id="ubicaciones-body">
                  <tr>
                    <td colspan="4">Todavía no agregas ubicaciones.</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </section>
        </div>

        <div class="tab-pane fade" id="tab-mensajes" role="tabpanel" aria-labelledby="tab-mensajes-tab">
          <section class="card">
            <div class="table-header">
              <h2>Mensajes preescritos</h2>
              <div class="table-actions">
                <button id="add-mensaje-btn" class="btn btn--secondary hidden">Nuevo mensaje</button>
              </div>
            </div>
            <p class="form-helper">
              Usa variables como <code>{nombre}</code>, <code>{numero_invitados}</code>, <code>{fecha_boda}</code>,
              <code>{fecha_limite_confirmar_asistencia}</code>, <code>{fecha_limite_detalles}</code>,
              <code>{codigo_invitado}</code> o <code>{link_mapa}</code> para personalizar cada mensaje.
            </p>
            <div class="form-helper example-message">
              <strong>Ejemplo rápido:</strong> Hola {nombre}, esta es tu invitación para {numero_invitados}. Por favor confirma
              antes del {fecha_limite_confirmar_asistencia}. El código de la invitación es {codigo_invitado}.
            </div>
            <div class="table-wrapper">
              <table>
                <thead>
                  <tr>
                    <th>Nombre</th>
                    <th>Vista previa</th>
                    <th>Variables detectadas</th>
                    <th>Acciones</th>
                  </tr>
                </thead>
                <tbody id="mensajes-body">
                  <tr>
                    <td colspan="4">Todavía no registras mensajes.</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </section>
        </div>

        <div class="tab-pane fade" id="tab-landing" role="tabpanel" aria-labelledby="tab-landing-tab">
          <section class="card">
            <div class="table-header">
              <h2>Widget de Pinterest</h2>
            </div>
            <p class="form-helper">
              Controla el tablero de Pinterest que mostramos en la página pública. Copia el enlace directo al tablero
              (por ejemplo: <code>https://www.pinterest.com/usuario/board-name/</code>) y ajusta las dimensiones del embed.
            </p>
            <form id="pinterest-form" class="form-grid">
              <label>Mostrar widget
                <select name="pinterestActivo">
                  <option value="true">Sí</option>
                  <option value="false">No</option>
                </select>
              </label>
              <label>URL del Pin o tablero
                <input type="url" name="pinterestPinUrl" placeholder="https://www.pinterest.com/usuario/mi-tablero/" />
              </label>
              <label>Ancho del pin (small, medium o large)
                <input type="text" name="pinterestPinWidth" placeholder="Ej. medium" />
              </label>
              <label>Descripción visible
                <textarea name="pinterestDescripcion" rows="2" placeholder="Texto que acompañará al widget."></textarea>
              </label>
              <div class="form-actions">
                <button type="submit" class="btn">Guardar widget</button>
              </div>
              <p class="form-helper" id="pinterest-mensaje"></p>
            </form>
          </section>
        </div>

        <div class="tab-pane fade" id="tab-damas" role="tabpanel" aria-labelledby="tab-damas-tab">
          <section class="card">
            <div class="table-header">
              <h2>Damas y Caballeros</h2>
              <div class="table-actions">
                <span class="capacity-pill capacity-pill--neutral">
                  Damas: <strong id="count-damas">--</strong>
                </span>
                <span class="capacity-pill capacity-pill--neutral">
                  Caballeros: <strong id="count-caballeros">--</strong>
                </span>
                <button id="add-dama-btn" class="btn btn--secondary hidden">Agregar</button>
              </div>
            </div>
            <div class="table-wrapper">
              <table class="display" id="tabla-damas">
                <thead>
                  <tr>
                    <th>Nombre</th>
                    <th>Lado</th>
                    <th>Rol</th>
                    <th>Vestuario</th>
                    <th>Imagen</th>
                    <th>Acciones</th>
                  </tr>
                </thead>
                <tbody id="damas-body">
                  <tr>
                    <td colspan="6">Aún no hay damas ni caballeros registrados.</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </section>
        </div>
        </div>

      </section>
    </main>

    <div class="modal fade" id="modal-crear" tabindex="-1" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered modal-lg">
        <div class="modal-content card">
          <div class="modal-header">
            <h2 class="modal-title">Crear invitado</h2>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
          </div>
          <div class="modal-body">
            <form id="crear-invitado-form" class="form-grid">
              <label>Nombre completo<input type="text" name="nombreCompleto" required /></label>
              <label>Lado
                <select name="lado">
                  <option value="novio">Novio</option>
                  <option value="novia">Novia</option>
                </select>
              </label>
              <label>Código
                <input
                  type="text"
                  name="codigoInvitacion"
                  placeholder="Se genera automáticamente"
                  readonly
                />
              </label>
              <div class="guest-total-display">
                <label>Total de invitados (automático)</label>
                <span id="crear-total-invitados">0</span>
                <input type="hidden" name="numInvitadosPermitidos" value="0" />
              </div>
              <label>Adultos asignados<input type="number" name="numAdultosPlaneados" min="0" value="0" /></label>
              <label>Niños asignados<input type="number" name="numNinosPlaneados" min="0" value="0" /></label>
              <label>Número de contacto<input type="tel" name="contactoPrincipal" placeholder="Ej. +52 55 1234 5678" required /></label>
              <label>Contactos adicionales (coma)
                <input type="text" name="contactosAdicionales" placeholder="+52..., +1..." />
              </label>
              <label>Estado (fase interna)
                <select name="estadoInvitacion">
                  <option value="pendiente_primera_confirmacion">Invitación sin respuesta</option>
                  <option value="confirmado_fase1">Confirmó asistencia</option>
                  <option value="confirmado_final">Checklist completado</option>
                  <option value="rechazado">Rechazado</option>
                </select>
              </label>
              <label>Lista de espera
                <select name="esListaEspera">
                  <option value="false">No</option>
                  <option value="true">Sí</option>
                </select>
              </label>
              <label>Prioridad lista de espera<input type="number" name="prioridadListaEspera" min="0" value="0" /></label>
              <label>Etiquetas (separadas por coma)
                <input type="text" name="etiquetas" placeholder="Familia, Amigos" />
              </label>
              <p class="form-helper" id="crear-etiquetas-sugerencia"></p>
              <div class="tag-editor" id="crear-tag-editor" data-form="crear"></div>
              <label>Notas<textarea name="notas" rows="2"></textarea></label>
              <div class="form-actions">
                <button type="submit" class="btn">Guardar</button>
                <button type="button" class="btn btn--secondary" data-bs-dismiss="modal">Cancelar</button>
              </div>
              <p class="form-helper" id="crear-invitado-mensaje"></p>
            </form>
          </div>
        </div>
      </div>
    </div>

    <div class="modal fade" id="modal-presupuesto" tabindex="-1" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content card">
          <div class="modal-header">
            <h2 class="modal-title">Registrar gasto o ingreso</h2>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
          </div>
          <div class="modal-body">
            <form id="presupuesto-form" class="form-grid" autocomplete="off">
              <input type="hidden" name="id" />
              <label>Concepto
                <input type="text" name="concepto" placeholder="Pastel de boda, DJ, etc." required />
              </label>
              <label>Tipo
                <select name="tipo">
                  <option value="gasto">Gasto</option>
                  <option value="ingreso">Ingreso</option>
                </select>
              </label>
              <label>Modalidad
                <select name="modalidad">
                  <option value="fijo">Costo fijo</option>
                  <option value="por_persona">Costo por persona</option>
                </select>
              </label>
              <label>Monto fijo
                <input type="number" name="montoBase" step="0.01" min="0" placeholder="Ej. 1500" />
              </label>
              <label>Costo por adulto
                <input type="number" name="costoAdulto" step="0.01" min="0" placeholder="Ej. 450" />
              </label>
              <label>Costo por niño (opcional)
                <input type="number" name="costoNino" step="0.01" min="0" placeholder="Ej. 250" />
              </label>
              <label>Notas
                <textarea name="notasMovimiento" rows="2" placeholder="Detalles adicionales"></textarea>
              </label>
              <div class="form-actions">
                <button type="submit" class="btn">Guardar</button>
                <button type="button" class="btn btn--secondary" data-bs-dismiss="modal">Cancelar</button>
              </div>
              <p class="form-helper" id="presupuesto-mensaje"></p>
            </form>
          </div>
        </div>
      </div>
    </div>

    <div class="modal fade" id="modal-tarea" tabindex="-1" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content card">
          <div class="modal-header">
            <h2 class="modal-title">Gestionar pendiente</h2>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
          </div>
          <div class="modal-body">
            <form id="tarea-form" class="form-grid">
              <input type="hidden" name="id" />
              <label>Título
                <input type="text" name="titulo" placeholder="Confirmar salón, buscar proveedor..." required />
              </label>
              <label>Descripción
                <textarea name="descripcion" rows="3" placeholder="Notas o checklist corto"></textarea>
              </label>
              <label>Fecha límite
                <input type="datetime-local" name="fechaLimite" required />
              </label>
              <label>Estado
                <select name="estado">
                  <option value="pendiente">Pendiente</option>
                  <option value="progreso">En progreso</option>
                  <option value="completado">Completado</option>
                </select>
              </label>
              <label>Responsable
                <select name="responsable">
                  <option value="novia">Novia</option>
                  <option value="novio">Novio</option>
                  <option value="ayudantes">Ayudantes</option>
                  <option value="ambos">Novia y Novio</option>
                </select>
              </label>
              <div class="form-actions">
                <button type="submit" class="btn">Guardar</button>
                <button type="button" class="btn btn--secondary" data-bs-dismiss="modal">Cancelar</button>
              </div>
              <p class="form-helper" id="tarea-mensaje"></p>
            </form>
          </div>
        </div>
      </div>
    </div>

    <div class="modal fade" id="modal-ubicacion" tabindex="-1" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content card">
          <div class="modal-header">
            <h2 class="modal-title">Registrar ubicación</h2>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
          </div>
          <div class="modal-body">
            <form id="ubicaciones-form" class="form-grid">
              <input type="hidden" name="id" />
              <label>Nombre del lugar
                <input type="text" name="nombreUbicacion" placeholder="Recepción, Salón del Reino..." required />
              </label>
              <label>Dirección
                <textarea name="direccionUbicacion" rows="2" placeholder="Calle, colonia, referencias" required></textarea>
              </label>
              <label>URL de Google Maps
                <input type="url" name="mapsUrl" placeholder="https://maps.google.com/..." required />
              </label>
              <div class="form-actions">
                <button type="submit" class="btn">Guardar</button>
                <button type="button" class="btn btn--secondary" data-bs-dismiss="modal">Cancelar</button>
              </div>
              <p class="form-helper" id="ubicaciones-mensaje"></p>
            </form>
          </div>
        </div>
      </div>
    </div>

    <div class="modal fade" id="modal-mensaje" tabindex="-1" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content card">
          <div class="modal-header">
            <h2 class="modal-title">Guardar mensaje</h2>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
          </div>
          <div class="modal-body">
            <form id="mensajes-form" class="form-grid">
              <input type="hidden" name="id" />
              <label>Nombre del mensaje
                <input type="text" name="tituloMensaje" placeholder="Recordatorio RSVP, Seguimiento viaje..." required />
              </label>
              <label>Contenido
                <textarea
                  name="contenidoMensaje"
                  rows="5"
                  placeholder="Hola {nombre}, recuerda confirmar antes del {fecha_limite_confirmar_asistencia}..."
                  required
                ></textarea>
              </label>
              <p class="form-helper">
                Variables disponibles: <code>{nombre}</code>, <code>{numero_invitados}</code>, <code>{fecha_boda}</code>,
                <code>{fecha_limite_confirmar_asistencia}</code>, <code>{fecha_limite_detalles}</code>,
                <code>{codigo_invitado}</code>, <code>{link_mapa}</code>. Escribe las llaves tal como en el ejemplo.
              </p>
              <div class="form-actions">
                <button type="submit" class="btn">Guardar</button>
                <button type="button" class="btn btn--secondary" data-bs-dismiss="modal">Cancelar</button>
              </div>
              <p class="form-helper" id="mensajes-mensaje"></p>
            </form>
          </div>
        </div>
      </div>
    </div>

    <div class="modal fade" id="modal-whatsapp" tabindex="-1" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content card">
          <div class="modal-header">
            <h2 class="modal-title">Enviar mensaje por WhatsApp</h2>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
          </div>
          <div class="modal-body">
            <div class="form-grid whatsapp-form">
              <div class="whatsapp-summary">
                <p class="form-helper"><strong>Invitado:</strong> <span id="whatsapp-nombre">--</span></p>
                <p class="form-helper"><strong>Contacto:</strong> <span id="whatsapp-contacto">--</span></p>
              </div>
              <label>Selecciona un mensaje
                <select id="whatsapp-template">
                  <option value="">No hay mensajes guardados todavía.</option>
                </select>
              </label>
              <label>Texto para enviar
                <textarea
                  id="whatsapp-preview"
                  rows="6"
                  placeholder="Selecciona una plantilla para generar el mensaje. Luego puedes ajustar el texto antes de enviarlo."
                ></textarea>
              </label>
              <div class="form-actions">
                <button type="button" class="btn btn--secondary" id="whatsapp-copy">Copiar mensaje</button>
                <button type="button" class="btn" id="whatsapp-send">Abrir WhatsApp</button>
              </div>
              <p class="form-helper" id="whatsapp-mensaje"></p>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="modal fade" id="modal-apoyo" tabindex="-1" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content card">
          <div class="modal-header">
            <h2 class="modal-title">Registrar apoyo o ahorro</h2>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
          </div>
          <div class="modal-body">
            <form id="apoyos-form" class="form-grid">
              <label>Descripción
                <input type="text" name="descripcion" placeholder="Donación, ahorro, etc." required />
              </label>
              <label>Monto
                <input type="number" name="monto" step="0.01" min="0" placeholder="Ej. 20000" required />
              </label>
              <label>Notas
                <textarea name="notasApoyo" rows="2" placeholder="Quién aporta, condiciones, etc."></textarea>
              </label>
              <div class="form-actions">
                <button type="submit" class="btn">Guardar</button>
                <button type="button" class="btn btn--secondary" data-bs-dismiss="modal">Cancelar</button>
              </div>
              <p class="form-helper" id="apoyos-mensaje"></p>
            </form>
          </div>
        </div>
      </div>
    </div>

    <div class="modal fade" id="modal-promover" tabindex="-1" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content card">
          <div class="modal-header">
            <h2 class="modal-title">Promover desde lista de espera</h2>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
          </div>
          <div class="modal-body">
            <form id="promover-form" class="form-grid">
              <p class="form-helper" id="promover-detalle">Selecciona nuevas fechas límite:</p>
              <label>Fecha límite de respuesta
                <input type="datetime-local" name="fechaLimiteRespuesta" required />
              </label>
              <label>Fecha límite checklist
                <input type="datetime-local" name="fechaLimiteDetalles" required />
              </label>
              <div class="form-actions">
                <button type="submit" class="btn">Confirmar promoción</button>
                <button type="button" class="btn btn--secondary" data-bs-dismiss="modal">
                  Cancelar
                </button>
              </div>
              <p class="form-helper" id="promover-mensaje"></p>
            </form>
          </div>
        </div>
      </div>
    </div>

    <div class="modal fade" id="modal-dama" tabindex="-1" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content card">
          <div class="modal-header">
            <h2 class="modal-title">Damas y Caballeros</h2>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
          </div>
          <div class="modal-body">
            <form id="damas-form" class="form-grid">
              <input type="hidden" name="id" />
              <label>Nombre completo<input type="text" name="nombre" required /></label>
              <label>Lado
                <select name="lado">
                  <option value="novia">Novia</option>
                  <option value="novio">Novio</option>
                </select>
              </label>
              <label>Rol
                <select name="rol">
                  <option value="dama">Dama de honor</option>
                  <option value="caballero">Caballero</option>
                </select>
              </label>
              <label>Vestuario confirmado
                <select name="vestuarioConfirmado">
                  <option value="false">Pendiente</option>
                  <option value="true">Confirmado</option>
                </select>
              </label>
              <label>Imagen del vestido o traje (URL)
                <input type="url" name="imagen" placeholder="https://..." />
              </label>
              <div class="form-actions">
                <button type="submit" class="btn">Guardar</button>
                <button type="button" class="btn btn--secondary" data-bs-dismiss="modal">Cancelar</button>
              </div>
              <p class="form-helper" id="damas-mensaje"></p>
            </form>
          </div>
        </div>
      </div>
    </div>

    <div class="modal fade" id="modal-editar" tabindex="-1" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered modal-lg">
        <div class="modal-content card">
          <div class="modal-header">
            <h2 class="modal-title">Editar invitado</h2>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
          </div>
          <div class="modal-body">
            <form id="editar-invitado-form" class="form-grid">
              <label>ID invitado<input type="text" name="id" placeholder="Documento seleccionado" readonly /></label>
              <label>Nombre completo<input type="text" name="nombreCompleto" /></label>
              <label>Lado
                <select name="lado">
                  <option value="novio">Novio</option>
                  <option value="novia">Novia</option>
                </select>
              </label>
              <div class="guest-total-display">
                <label>Total de invitados (automático)</label>
                <span id="editar-total-invitados">0</span>
                <input type="hidden" name="numInvitadosPermitidos" value="0" />
              </div>
              <label>Adultos asignados<input type="number" name="numAdultosPlaneados" min="0" /></label>
              <label>Niños asignados<input type="number" name="numNinosPlaneados" min="0" /></label>
              <label>Estado (fase interna)
                <select name="estadoInvitacion">
                  <option value="pendiente_primera_confirmacion">Invitación sin respuesta</option>
                  <option value="confirmado_fase1">Confirmó asistencia</option>
                  <option value="confirmado_final">Checklist completado</option>
                  <option value="rechazado">Rechazado</option>
                  <option value="cancelado_por_tiempo">Cancelado por tiempo</option>
                </select>
              </label>
              <label>Número confirmado de asistentes<input type="number" name="rsvpNumAsistentes" min="0" /></label>
              <label>Número de contacto<input type="tel" name="contactoPrincipal" placeholder="Ej. +52 55 1234 5678" /></label>
              <label>Contactos adicionales (coma)<input type="text" name="contactosAdicionales" placeholder="+52..., +1..." /></label>
              <label>Vestimenta lista<select name="vestimentaConfirmada"><option value="false">No</option><option value="true">Sí</option></select></label>
              <label>Viaje listo<select name="viajeConfirmado"><option value="false">No</option><option value="true">Sí</option></select></label>
              <label>Hospedaje listo<select name="hospedajeConfirmado"><option value="false">No</option><option value="true">Sí</option></select></label>
              <label>Lista de espera<select name="esListaEspera"><option value="false">No</option><option value="true">Sí</option></select></label>
              <label>Prioridad lista de espera<input type="number" name="prioridadListaEspera" min="0" /></label>
              <label>Etiquetas (separadas por coma)<input type="text" name="etiquetas" /></label>
              <p class="form-helper" id="editar-etiquetas-sugerencia"></p>
              <div class="tag-editor" id="editar-tag-editor" data-form="editar"></div>
              <label>Notas<textarea name="notas" rows="3"></textarea></label>
              <div class="form-actions">
                <button type="submit" class="btn">Actualizar</button>
                <button type="button" id="asignar-lugar" class="btn btn--secondary">Asignar lugar</button>
                <button type="button" id="borrar-invitado" class="btn btn--danger">Eliminar</button>
                <button type="button" class="btn btn--secondary" data-bs-dismiss="modal">Cerrar</button>
              </div>
              <p class="form-helper" id="editar-invitado-mensaje"></p>
            </form>
          </div>
        </div>
      </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/10.13.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.13.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.13.1/firebase-firestore-compat.js"></script>
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
      crossorigin="anonymous"
    ></script>
    <script src="https://cdn.datatables.net/1.13.8/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/responsive/2.5.0/js/dataTables.responsive.min.js"></script>
    <script src="../assets/js/firebase-config.js"></script>
    <script src="../assets/js/admin.js"></script>
  </body>
</html>
